# Memory management optimizations for desktop Linux
# These settings work well with both zram and zswap configurations.

# Swappiness: How aggressively the kernel moves pages to swap.
# - For ZRAM (compressed RAM): Higher values (150-180) are ideal since zram is fast.
# - For ZSWAP (compressed cache + disk): Lower values (60-100) prevent pool saturation.
# This default of 100 is a balanced choice. Adjust based on your swap_mode:
#   zram modes: vm.swappiness = 150
#   zswap modes: vm.swappiness = 80
vm.swappiness = 100

# Prefer to keep inode/dentry caches over page cache. Greatly improves filesystem
# operations speed on a desktop. Default is 100, lower = more caching.
vm.vfs_cache_pressure = 50

# Start flushing dirty pages to disk earlier but in smaller chunks to avoid I/O stalls.
# Defaults are 10 and 20 respectively.
vm.dirty_background_ratio = 5
vm.dirty_ratio = 20

# Disable proactive memory compaction to prevent system stutter.
# Compaction can cause significant latency spikes on desktop workloads.
vm.compaction_proactiveness = 0

# Disable watermark boosting, which can cause aggressive page reclaim due to fragmentation.
vm.watermark_boost_factor = 0

# Increase the amount of free memory the kernel tries to maintain,
# allowing for more background reclaim and reducing direct reclaim latency.
# Default is 10, higher values = more free memory headroom.
vm.watermark_scale_factor = 125

# Page cluster: Number of consecutive pages read during swap-in.
# 0 = read only the requested page (no readahead).
# Best for zram/zswap where random access is fast.
# Default is 3 (8 pages). Set to 0 for compressed swap.
vm.page-cluster = 0

# Reduces unfairness in page locking to reduce tail latency.
# Default is 5, lower values reduce worst-case latency.
vm.page_lock_unfairness = 1
